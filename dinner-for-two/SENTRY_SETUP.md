# Настройка Sentry для мониторинга ошибок

Sentry интегрирован в приложение для централизованного сбора и отслеживания ошибок.

## Шаг 1: Создание проекта в Sentry

1. Зарегистрируйтесь или войдите в [Sentry](https://sentry.io)
2. Создайте новый проект:
   - Выберите платформу: **Next.js**
   - Назовите проект (например, `salates-and-olivetes`)
   - Запишите **DSN** (Data Source Name) - он понадобится для настройки

## Шаг 2: Настройка переменных окружения

Добавьте следующие переменные в Vercel:

### Обязательные:
- `NEXT_PUBLIC_SENTRY_DSN` - DSN вашего Sentry проекта (начинается с `https://...`)

### Опциональные (для загрузки source maps):
- `SENTRY_ORG` - slug вашей организации в Sentry
- `SENTRY_PROJECT` - slug вашего проекта в Sentry
- `SENTRY_AUTH_TOKEN` - токен для загрузки source maps (можно создать в Settings → Auth Tokens)

## Шаг 3: Получение SENTRY_AUTH_TOKEN (опционально)

1. В Sentry перейдите в **Settings** → **Auth Tokens**
2. Нажмите **Create New Token**
3. Выберите права:
   - `project:releases` - для загрузки source maps
   - `org:read` - для чтения информации об организации
4. Скопируйте токен и добавьте в Vercel как `SENTRY_AUTH_TOKEN`

## Шаг 4: Проверка работы

После деплоя:

1. Откройте приложение и попробуйте вызвать ошибку (например, добавьте невалидное блюдо)
2. Перейдите в Sentry Dashboard → **Issues**
3. Вы должны увидеть ошибки, которые произошли в приложении

## Что отслеживается

Sentry автоматически отслеживает:
- Ошибки в server actions (`actions.ts`)
- Ошибки в React компонентах (через ErrorBoundary)
- Ошибки в клиентском коде
- Ошибки в серверном коде

## Фильтрация ошибок

Некоторые ошибки автоматически фильтруются и не отправляются в Sentry:
- Ошибки валидации AI (ожидаемые ошибки, когда пользователь вводит невалидное название блюда)
- Ошибки, которые уже обработаны и показаны пользователю

## Просмотр ошибок

В Sentry Dashboard вы можете:
- Видеть все ошибки в реальном времени
- Просматривать stack traces с исходным кодом (если настроены source maps)
- Видеть контекст ошибки (userId, coupleId, action, metadata)
- Получать уведомления о новых ошибках
- Группировать похожие ошибки

## Отключение Sentry

Если вы хотите временно отключить Sentry:
1. Удалите или закомментируйте `NEXT_PUBLIC_SENTRY_DSN` в Vercel
2. Пересоберите приложение

## Дополнительная информация

- [Документация Sentry для Next.js](https://docs.sentry.io/platforms/javascript/guides/nextjs/)
- [Настройка source maps](https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/#upload-source-maps)


